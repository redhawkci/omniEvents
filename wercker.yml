build:
  box: redhawkci/rpmbuild:el6
  steps:
    - script:
        name: install dependencies
        code: yum-builddep -y omniEvents.spec

    - script:
        name: build packages
        code: |
          tar --transform 's,^\.,omniEvents-2.7.0,' -czvf /root/rpmbuild/SOURCES/omniEvents-2.7.0.tar.gz .
          rpmbuild -bb omniEvents.spec

    - script:
        name: copy output
        code: |
          cp -rv /root/rpmbuild/RPMS/x86_64/* "$WERCKER_OUTPUT_DIR"

deploy:
    box: python
    steps:
    - s3sync:
        source-dir: .
        bucket-url: $AWS_BUCKET_URL
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY
